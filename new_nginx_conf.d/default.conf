gzip off;
gzip_types text/plain application/xml application/json;
gzip_min_length 1000;

client_max_body_size 100M;

server{
    listen 80;
    location / {
       return 301 https://$host$request_uri;
    }
}

# Prod front
server{
    listen  443 ssl;
    ssl_certificate /etc/letsencrypt/live/mapisto.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/mapisto.org/privkey.pem;
    server_name mapisto.org;
    location / {
        proxy_pass http://mapisto-front-prod:5000;
    }
}

#Prod API
server{
    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/api.mapisto.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.mapisto.org/privkey.pem;
    server_name api.mapisto.org;
    location / {
        proxy_pass http://mapisto-api-prod:5000;
    }
}

# dev front
server{
    listen  443 ssl;
    ssl_certificate /etc/letsencrypt/live/dev.mapisto.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/dev.mapisto.org/privkey.pem;
    server_name mapisto.org;
    location / {
        proxy_pass http://mapisto-front-dev;
    }
}

#dev API
server{
    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/api.dev.mapisto.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.dev.mapisto.org/privkey.pem;
    server_name api.mapisto.org;
    location / {
        proxy_pass http://mapisto-api-dev:5000;
    }
}
